<!DOCTYPE html>
<!-- saved from url=(0066)http://dmolinarius.github.io/demofiles/elc-d3/cours3/example1.html -->
<html lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>example1</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
</head>


    <body onload="demarrage()">

        <header>
            zjefbhezfbh
        </header>

        
        <div id="allPage"> 
            <div class = "bandeau">
            </div>
            <div class = "mainPage">
                <div class="frontMusic">
                    <div class="canva">
                        <div class="imageFront">
                            <img src="images/SawanoCover.jpg" id="albumCover"/>
                        </div>
                        <div class="texteFront">
                            <h3>Titre</h3>
                            <h1 id="h1_Titre">Remember</h1>
                            <h3 id="infos">Sawano Hiroyuki, 2012</h3>
                            <h3 id="infos_album">Sawano Hiroyuki, 2012</h3>
                            
                        </div>
                    </div>
                </div>
                <div class="folders">
                    <div class="player">
                        <audio id="balise_audio" src="/music/pkmn.mp3"></audio>
                        <div class="navi">
                            <span class="prev">
                                <ion-icon name="caret-back"></ion-icon>
                            </span>
                            <span class="playPause">
                                <ion-icon name="play"></ion-icon>
                            </span>
                            <span class="next">
                                <ion-icon name="caret-forward"></ion-icon>
                            </span>
                        </div>
                        <div class="progress-container">
                            <div class="progress"></div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        
    </body>

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>


    <script>
        

        const playPause = document.querySelector(".playPause");
        const prev = document.querySelector(".prev");
        const next = document.querySelector(".next");
        const progress = document.querySelector(".progress");
        const progressCont = document.querySelector(".progress-container");
        const audio = document.querySelector("audio");
        

        let songPlay=false;
        
        function Play(){
            songPlay=true;
            audio.play();
            playPause.innerHTML = '<ion-icon name="pause"></ion-icon>';
            console.log("ouiiiiiii")
        }

        function Pause(){
            songPlay=false;
            audio.pause();
            playPause.innerHTML = '<ion-icon name="play"></ion-icon>';
        }

        playPause.addEventListener("click", () => (songPlay ? Pause() : Play()));
        audio.addEventListener('timeupdate', updateBarre);
        progressCont.addEventListener('click', goToMusique);
        next.addEventListener("click",clickNext);
        prev.addEventListener("click",clickPrev);


        

        function updateBarre(ev){
            time = ev.srcElement.currentTime;
            time_tot = ev.srcElement.duration;
            ratio=(time/time_tot)*100;
            progress.style.width=`${ratio}%`;
            console.log("test");

        }

        function goToMusique(ev){
            const tot_width=this.clientWidth;
            const xClick = ev.offsetX;
            const time_tot=audio.duration;

            audio.currentTime=(xClick/tot_width)*time_tot;
        }

        function clickNext(id_button){
            console.log("j'AI CLIQUE C'EST MAL");
            album_name="<%= album%>";
            artiste_name="<%= artiste%>";
            liste_songs=JSON.parse(httpGet("http://localhost:3000/get/album/"+artiste_name+"/"+album_name)).liste_songs;
            titre_complet="<%= titre%>"+".ogg";
            index_current_song=liste_songs.indexOf(titre_complet);
            console.log("BoutonNext");
            indexfuture=(index_current_song+1)%liste_songs.length;
            next_song=liste_songs[indexfuture].substring(0,liste_songs[indexfuture].length-4);
            httpGet("http://localhost:3000/get/current_song_set/"+artiste_name+"/"+album_name+"/"+next_song);
            location.href="/listen";
        }

        function clickPrev(id_button){
            console.log("j'AI CLIQUE C'EST MAL");
            album_name="<%= album%>";
            artiste_name="<%= artiste%>";
            liste_songs=JSON.parse(httpGet("http://localhost:3000/get/album/"+artiste_name+"/"+album_name)).liste_songs;
            titre_complet="<%= titre%>"+".ogg";
            index_current_song=liste_songs.indexOf(titre_complet);
            console.log("BoutonNext");
            indexfuture=(index_current_song-1)%liste_songs.length;
            next_song=liste_songs[indexfuture].substring(0,liste_songs[indexfuture].length-4);
            httpGet("http://localhost:3000/get/current_song_set/"+artiste_name+"/"+album_name+"/"+next_song);
            location.href="/listen";
        }


        function changeSong(){
            //changer le titre et tout
            //changer le src de audio
            document.getElementById("h1_Titre").innerHTML="<%= titre %>";
            document.getElementById("infos_album").innerHTML="<%= album %>";
            document.getElementById("infos").innerHTML= "<%= artiste %>";
            document.getElementById("balise_audio").src="<%= path_musique %>";
            console.log("<%= path_musique %>");
            document.getElementById("albumCover").src="http://localhost:3000/get/image/album/"+"<%= album %>";
            
        }
    
        function mod(){
            const carre = document.querySelector(".canva")
            carre.classList.add("biggerCanva")
            const front = document.querySelector(".frontMusic")
            front.classList.add("smallerFront")
            console.log("njezfnjzeifziejfb")
        }

        function demarrage(){
            changeSong();
            mod();
        }

        function httpGet(theUrl) {
        let xmlHttpReq = new XMLHttpRequest();
        xmlHttpReq.open("GET", theUrl, false);
        xmlHttpReq.send(null);
        return xmlHttpReq.responseText;
        }


        
        
    </script>
    
</html>

